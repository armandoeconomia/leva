<div class="patient-page">
  <div class="patient-container">
    <section class="patient-hero">
      <div>
        <p class="eyebrow">Tu espacio como paciente</p>
        <h1>Encuentra tu especialista y reserva tu cita</h1>
        <p class="muted">Revisa tu historial, controla tus citas y mantén tus datos médicos al día.</p>
        <div class="hero-actions">
          <%= link_to "Reservar cita", new_patients_appointment_path, class: "btn-lilac" %>
          <%= link_to "Ver doctores", patients_doctors_path, class: "btn-ghost" %>
        </div>
      </div>
      <div class="hero-card">
        <p class="eyebrow">Tus datos</p>
        <h3><%= @patient.user.name %> <%= @patient.user.last_name %></h3>
        <p class="muted">Tipo de sangre: <strong><%= @patient.blood_type %></strong></p>
        <p class="muted">Contacto de emergencia: <strong><%= @patient.emergency_contact %></strong></p>
      </div>
    </section>

    <section class="patient-grid">
      <div class="patient-card">
        <div class="section-header">
          <div>
            <p class="eyebrow">Próximas citas</p>
            <h2>Tus citas agendadas</h2>
          </div>
          <%= link_to "Ver todas", patients_appointments_path, class: "link-lilac" %>
        </div>
        <% if @upcoming_appointments.any? %>
          <div class="card-list">
            <% @upcoming_appointments.first(3).each do |appointment| %>
              <div class="item-card">
                <div class="item-avatar">
                  <i class="fa fa-user-md"></i>
                </div>
                <div class="item-body">
                  <p class="item-title"><%= appointment.doctor.user.name %> <%= appointment.doctor.user.last_name %></p>
                  <p class="muted"><%= appointment.doctor.speciality.humanize %> · <%= appointment.date&.strftime('%d %b %Y') %> · <%= appointment.hour&.strftime('%H:%M') %></p>
                </div>
                <div class="item-actions">
                  <span class="status-pill <%= appointment.status %>"><%= appointment.status %></span>
                  <%= link_to "Ver", patients_appointment_path(appointment), class: "btn-ghost-sm" %>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <p class="muted">Aún no tienes citas programadas.</p>
        <% end %>
      </div>

      <div class="patient-card">
        <div class="section-header">
          <div>
            <p class="eyebrow">Tu salud</p>
            <h2>Historial médico reciente</h2>
          </div>
          <%= link_to "Ver historial", patients_medical_histories_path, class: "link-lilac" %>
        </div>
        <% if @recent_medical_histories.any? %>
          <div class="card-list">
            <% @recent_medical_histories.each do |history| %>
              <div class="item-card">
                <div class="item-avatar">
                  <i class="fa fa-file-medical-alt"></i>
                </div>
                <div class="item-body">
                  <p class="item-title"><%= history.diagnosis.truncate(40) %></p>
                  <p class="muted"><%= history.registration_date&.strftime('%d %b %Y') %> · <%= history.doctor.user.name %></p>
                </div>
                <div class="item-actions">
                  <%= link_to "Ver detalle", patients_medical_history_path(history), class: "btn-ghost-sm" %>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <p class="muted">Aún no hay registros médicos.</p>
        <% end %>
      </div>
    </section>
  </div>
</div>
