<% appointments = @appointments || [] %>
<% pending = appointments.select { |a| a.status == "pendiente" } %>

<div class="admin-shell" style="padding: 32px 40px 48px; max-width: 1100px; margin: 0 auto;">
  <div class="admin-page-header">
    <div>
      <span class="page-eyebrow">Citas</span>
      <h1 class="admin-page-title">Citas asignadas</h1>
      <p class="admin-page-description">
        Gestiona tus citas: revísalas, edítalas, confírmalas o cancélalas.
      </p>
    </div>
  </div>

  <div class="admin-metrics justify-content-center" style="gap: 12px; flex-wrap: wrap; margin-bottom: 20px;">
    <div class="admin-metric-card" style="min-width: 160px; border-radius: 14px; padding: 14px 16px; box-shadow: 0 14px 28px rgba(0,0,0,0.05);">
      <p class="admin-metric-value"><%= appointments.size %></p>
      <p class="admin-metric-label">Total citas</p>
    </div>
    <div class="admin-metric-card" style="min-width: 160px; border-radius: 14px; padding: 14px 16px; box-shadow: 0 14px 28px rgba(0,0,0,0.05);">
      <p class="admin-metric-value"><%= pending.size %></p>
      <p class="admin-metric-label">Pendientes</p>
    </div>
    <div class="admin-metric-card" style="min-width: 160px; border-radius: 14px; padding: 14px 16px; box-shadow: 0 14px 28px rgba(0,0,0,0.05);">
      <p class="admin-metric-value"><%= appointments.count { |a| a.status == "completado" } %></p>
      <p class="admin-metric-label">Completadas</p>
    </div>
    <div class="admin-metric-card" style="min-width: 160px; border-radius: 14px; padding: 14px 16px; box-shadow: 0 14px 28px rgba(0,0,0,0.05);">
      <p class="admin-metric-value"><%= appointments.count { |a| a.status == "cancelado" } %></p>
      <p class="admin-metric-label">Canceladas</p>
    </div>
  </div>

<section class="admin-card mt-8" style="border-radius: 18px; box-shadow: 0 22px 38px rgba(0,0,0,0.06); padding: 22px;">
  <div class="admin-card__header">
    <div>
      <p class="page-eyebrow">Listado</p>
      <h2 class="admin-card__title">Citas agendadas</h2>
      <p class="admin-card__description">
        Visualiza tus citas con estado y acciones rápidas.
      </p>
    </div>
  </div>

  <% if appointments.any? %>
    <div class="admin-table-wrapper" style="border-radius: 18px; overflow: hidden;">
      <table class="admin-table">
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Hora</th>
            <th>Paciente</th>
            <th>Motivo</th>
            <th>Estado</th>
            <th class="text-right">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <% appointments.each do |appt| %>
            <% patient_name = appt.patient&.user&.name || "Paciente" %>
            <tr>
              <td><%= l(appt.date, format: '%d %b %Y') rescue appt.date %></td>
              <td><%= appt.hour&.strftime('%H:%M') || appt.hour %></td>
              <td><strong><%= patient_name %></strong></td>
              <td class="text-muted"><%= appt.reason_for_consultation.presence || "Sin motivo" %></td>
              <td><span class="status-pill <%= appt.status %>"><%= appt.status.to_s.titleize %></span></td>
              <td class="text-right">
                <div class="d-flex gap-2 justify-content-end flex-wrap">
                  <%= link_to "Ver", doctors_appointment_path(appt), class: "btn-leva-ghost", style: "padding: 8px 14px; border-radius: 12px;" %>
                  <%= link_to "Editar", edit_doctors_appointment_path(appt), class: "btn-leva-plain", style: "padding: 8px 14px; border-radius: 12px;" %>
                  <%= link_to "Confirmar", confirm_doctors_appointment_path(appt), method: :patch, class: "btn-leva-primary", style: "padding: 8px 14px; border-radius: 12px;" %>
                  <%= link_to "Cancelar", cancel_doctors_appointment_path(appt), method: :patch, class: "btn-leva-ghost", style: "padding: 8px 14px; border-radius: 12px; background: rgba(255,202,58,0.18); color: #2A2A2A;" %>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% else %>
    <p class="muted">No hay citas asignadas todavía.</p>
  <% end %>
</section>
</div>
